## Network Policies for Namespaces

This NP will work exactly the same it did for Pods. In previous lessons, there was revise the concept of targeting resources (Pods) in different namespaces.
So that, now we will explore the role of the NetworkPolicies.

-----------------------------------

## Demo

Begin with creating a namespace, and a Pod on it; and a second pod in the default namespace.




```bash
kubectl create ns np-ns
namespace/np-ns created

kubectl apply -f nginx-default.yaml
pod/np-nginx created

kubectl apply -f busybox-np-ns.yaml
pod/busybox-np-ns created

kubectl expose pod np-nginx --port=80
service/np-nginx exposed

kubectl exec -it busybox-np-ns -n np-ns -- wget --spider --timeout=1 np-nginx.default.svc.cluster.local
Connecting to np-nginx.default.svc.cluster.local (10.97.218.148:80)
remote file exists

kubectl apply -f ns-np.yaml
networkpolicy.networking.k8s.io/deny-from-other-namespaces created
```

Breaking the content of the following NetworkPolicy, it clearly states that its apply for default namespace and allow traffic from any podSelector matching...
Matching nothing! Therefore, it isolates the resoure completely. It is now expected that the previous wget, fails.

```YAML
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-deny-all
  namespace: default
spec:
  podSelector: {} # Apply to all pods
  ingress:
  - from:
    - namespaceSelector: {} # Deny from all namespaces
  policyTypes:
  - Ingress

```

```bash
kubectl exec -it busybox-np-ns -n np-ns -- wget --spider --timeout=1 np-nginx.default.svc.cluster.local
```






~kubectl get pods -n kube-system | grep flannel
kube-flannel-62xbw                      1/1     Running   4 (21d ago)          22d
kube-flannel-7vmfh                      1/1     Running   15 (22m ago)         24d
kube-flannel-vs49v                      1/1     Running   13 (13m ago)         23d
kube-flannel-z7dlk                      1/1     Running   21 (<invalid> ago)   24d

~kubectl get pods -n default
NAME       READY   STATUS    RESTARTS      AGE
np-nginx   1/1     Running   1 (13m ago)   20m

~kubectl get pods -n np-ns
NAME            READY   STATUS    RESTARTS   AGE
busybox-np-ns   1/1     Running   0          15m

~kubectl get networkpolicy
NAME                   POD-SELECTOR   AGE
deny-cross-namespace   <none>         2m44s

~kubectl describe networkpolicy deny-cross-namespace
Name:         deny-cross-namespace
Namespace:    default
Created on:   2025-02-15 17:45:32 -0300 -03
Labels:       <none>
Annotations:  <none>
Spec:
  PodSelector:     <none> (Allowing the specific traffic to all pods in this namespace)
  Allowing ingress traffic:
    To Port: <any> (traffic allowed to all ports)
    From:
      PodSelector: <none>
  Not affecting egress traffic
  Policy Types: Ingress

~kubectl exec -it busybox-np-ns -n np-ns -- wget --spider --timeout=1 np-nginx.default.svc.cluster.local
Connecting to np-nginx.default.svc.cluster.local (10.97.218.148:80)
remote file exists



--------------------------


https://github.com/flannel-io/flannel/issues/2183